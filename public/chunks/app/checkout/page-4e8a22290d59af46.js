(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8279],{2821:(e,t,r)=>{"use strict";function s(){for(var e,t,r=0,s="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=function e(t){var r,s,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t)if(Array.isArray(t)){var n=t.length;for(r=0;r<n;r++)t[r]&&(s=e(t[r]))&&(a&&(a+=" "),a+=s)}else for(s in t)t[s]&&(a&&(a+=" "),a+=s);return a}(e))&&(s&&(s+=" "),s+=t);return s}r.d(t,{$:()=>s})},3998:(e,t,r)=>{"use strict";r.d(t,{$:()=>l,A:()=>i});var s=r(49095),a=r(28175),n=r(2821);let l=(0,a.forwardRef)((e,t)=>{let{className:r,variant:a="primary",size:l="md",loading:i,children:d,disabled:o,...c}=e,m=(0,n.$)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",{primary:"bg-orange-500 text-white hover:bg-orange-600 focus:ring-orange-500 shadow-sm hover:shadow-md",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500 shadow-sm hover:shadow-md",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-orange-500 shadow-sm hover:shadow-md",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-orange-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500 shadow-sm hover:shadow-md"}[a],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[l],r),u=(0,s.jsxs)(s.Fragment,{children:[i&&(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",suppressHydrationWarning:!0,children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",suppressHydrationWarning:!0}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",suppressHydrationWarning:!0})]}),d]});return(0,s.jsx)("button",{className:m,ref:t,disabled:o||i,...c,suppressHydrationWarning:!0,children:u})});l.displayName="Button";let i=l},25959:(e,t,r)=>{"use strict";r.d(t,{v:()=>l});var s=r(28175);let a=e=>{let t,r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,n={setState:s,getState:a,getInitialState:()=>l,subscribe:e=>(r.add(e),()=>r.delete(e))},l=t=e(s,a,n);return n},n=e=>{let t=(e=>e?a(e):a)(e),r=e=>(function(e,t=e=>e){let r=s.useSyncExternalStore(e.subscribe,s.useCallback(()=>t(e.getState()),[e,t]),s.useCallback(()=>t(e.getInitialState()),[e,t]));return s.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},l=e=>e?n(e):n},35848:(e,t,r)=>{Promise.resolve().then(r.bind(r,38293))},38293:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>q});var s=r(49095),a=r(28175),n=r(46944),l=r(76447),i=r.n(l),d=r(61289),o=r(22158),c=r.n(o),m=r(77684).Buffer,u=r(10924);class h{createPaymentRequest(e){let{amount:t,productId:r,orderId:s}=e,a=t.toFixed(2);return{tAmt:(parseFloat(a)+parseFloat("0")+parseFloat("0")+parseFloat("0")).toFixed(2),amt:a,txAmt:"0",psc:"0",pdc:"0",scd:this.config.merchantId,pid:"".concat(r,"-").concat(s,"-").concat(Date.now()),su:this.config.successUrl,fu:this.config.failureUrl}}getPaymentUrl(e){let t=new URLSearchParams(e);return"".concat(this.config.baseUrl,"/epay/main?").concat(t.toString())}async verifyPayment(e,t,r){try{let s="".concat(this.config.baseUrl,"/epay/transrec"),a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({oid:e,amt:t,rid:r}).toString()});if(!a.ok)throw Error("eSewa verification failed: ".concat(a.status));let n=await a.text();return n.includes("Success")||n.includes(r)}catch(e){return console.error("eSewa payment verification error:",e),!1}}generateSignature(e){let t=Object.keys(e).sort().map(t=>"".concat(t,"=").concat(e[t])).join(",");return c().createHmac("sha256",this.config.secretKey).update(t).digest("base64")}validateWebhookSignature(e,t,r){try{let s=c().createHmac("sha256",this.config.secretKey).update("".concat(r,".").concat(e)).digest("hex");return c().timingSafeEqual(m.from(t,"hex"),m.from(s,"hex"))}catch(e){return console.error("eSewa webhook signature validation error:",e),!1}}constructor(e){this.config=e}}let x=null,p=()=>{if(!x){let e={merchantId:u.env.ESEWA_MERCHANT_ID,secretKey:u.env.ESEWA_SECRET_KEY,baseUrl:u.env.ESEWA_BASE_URL,successUrl:u.env.PAYMENT_SUCCESS_URL,failureUrl:u.env.PAYMENT_FAILURE_URL};if(!e.merchantId||!e.secretKey||!e.baseUrl)throw Error("eSewa configuration is incomplete. Check environment variables.");x=new h(e)}return x};var y=r(77684).Buffer,g=r(10924);class f{async initiatePayment(e){try{let t={return_url:this.config.successUrl,website_url:e.website_url||this.config.successUrl,amount:e.amount,purchase_order_id:e.orderId,purchase_order_name:e.productName,customer_info:e.customerInfo,amount_breakdown:e.amountBreakdown,product_details:[{identity:e.productIdentity,name:e.productName,total_price:e.amount,quantity:1,unit_price:e.amount}]},r=await fetch("".concat(this.config.baseUrl,"/api/v2/epayment/initiate/"),{method:"POST",headers:{Authorization:"Key ".concat(this.config.secretKey),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){let e=await r.json();throw Error("Khalti payment initiation failed: ".concat(JSON.stringify(e)))}return await r.json()}catch(e){throw console.error("Khalti payment initiation error:",e),e}}async verifyPayment(e){try{let t=await fetch("".concat(this.config.baseUrl,"/api/v2/epayment/lookup/"),{method:"POST",headers:{Authorization:"Key ".concat(this.config.secretKey),"Content-Type":"application/json"},body:JSON.stringify({pidx:e})});if(!t.ok){let e=await t.json();throw Error("Khalti payment verification failed: ".concat(JSON.stringify(e)))}return await t.json()}catch(e){throw console.error("Khalti payment verification error:",e),e}}isPaymentSuccessful(e){return"Completed"===e.status}getPaymentStatusText(e){return({Completed:"Payment Successful",Pending:"Payment Pending",Initiated:"Payment Initiated",Refunded:"Payment Refunded",Failed:"Payment Failed",Expired:"Payment Expired","User Canceled":"Payment Canceled by User"})[e]||"Unknown Status"}validateWebhookSignature(e,t,r){try{let s=c().createHmac("sha256",this.config.secretKey).update("".concat(r,".").concat(e)).digest("hex");return c().timingSafeEqual(y.from(t,"hex"),y.from(s,"hex"))}catch(e){return console.error("Khalti webhook signature validation error:",e),!1}}convertNprToPaisa(e){return Math.round(100*e)}convertPaisaToNpr(e){return e/100}constructor(e){this.config=e}}let v=null,b=()=>{if(!v){let e={publicKey:g.env.KHALTI_PUBLIC_KEY,secretKey:g.env.KHALTI_SECRET_KEY,baseUrl:g.env.KHALTI_BASE_URL,successUrl:g.env.PAYMENT_SUCCESS_URL,failureUrl:g.env.PAYMENT_FAILURE_URL};if(!e.publicKey||!e.secretKey||!e.baseUrl)throw Error("Khalti configuration is incomplete. Check environment variables.");v=new f(e)}return v};var j=r(34051);class N{async initiatePayment(e){try{switch(e.method){case"esewa":return await this.initiateESewaPayment(e);case"khalti":return await this.initiateKhaltiPayment(e);case"cod":return await this.initiateCODPayment(e);default:throw Error("Unsupported payment method: ".concat(e.method))}}catch(t){return console.error("Payment initiation error:",t),{method:e.method,success:!1,error:t instanceof Error?t.message:"Payment initiation failed"}}}async verifyPayment(e,t,r){try{switch(e){case"esewa":return await this.verifyESewaPayment(t,r);case"khalti":return await this.verifyKhaltiPayment(t);case"cod":return await this.verifyCODPayment(t,r);default:throw Error("Unsupported payment method: ".concat(e))}}catch(r){return console.error("Payment verification error:",r),{method:e,success:!1,transactionId:t,amount:0,orderId:"",error:r instanceof Error?r.message:"Payment verification failed"}}}getPaymentMethodDisplayName(e){return({esewa:"eSewa",khalti:"Khalti",cod:"Cash on Delivery"})[e]||e}isOnlinePaymentMethod(e){return"cod"!==e}getPaymentMethodIcon(e){return({esewa:"/images/payment/esewa-logo.png",khalti:"/images/payment/khalti-logo.png",cod:"/images/payment/cod-icon.png"})[e]||"/images/payment/default.png"}async initiateESewaPayment(e){var t,r;let s=p(),a={amount:e.amount,productId:e.orderId,productName:e.productName,orderId:e.orderId,customerEmail:null==(t=e.customerInfo)?void 0:t.email,customerPhone:null==(r=e.customerInfo)?void 0:r.phone},n=s.createPaymentRequest(a);return{method:"esewa",success:!0,paymentUrl:s.getPaymentUrl(n),transactionId:n.pid,data:n}}async initiateKhaltiPayment(e){let t=b(),r={amount:t.convertNprToPaisa(e.amount),productIdentity:e.orderId,productName:e.productName,orderId:e.orderId,customerInfo:e.customerInfo},s=await t.initiatePayment(r);return{method:"khalti",success:!0,paymentUrl:s.payment_url,transactionId:s.pidx,data:s}}async initiateCODPayment(e){return{method:"cod",success:!0,transactionId:"cod-".concat(e.orderId,"-").concat(Date.now()),data:{orderId:e.orderId,amount:e.amount,method:"cod"}}}async verifyESewaPayment(e,t){let r=p();return{method:"esewa",success:await r.verifyPayment(t.oid,t.amt,t.refId),transactionId:t.refId,amount:parseFloat(t.amt),orderId:t.oid,data:t}}async verifyKhaltiPayment(e){let t=b(),r=await t.verifyPayment(e);return{method:"khalti",success:t.isPaymentSuccessful(r),transactionId:r.transaction_id,amount:t.convertPaisaToNpr(r.total_amount),orderId:r.purchase_order_id,data:r}}async verifyCODPayment(e,t){return{method:"cod",success:!0,transactionId:e,amount:t.amount,orderId:t.orderId}}}let w=null;function S(e){let{selectedMethod:t,onMethodSelect:r,orderTotal:a,disabled:n=!1}=e;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Payment Method"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Choose your preferred payment method to complete your order."}),(0,s.jsx)("div",{className:"space-y-3",children:["esewa","khalti","cod"].map(e=>{let l=(e=>{let t=(w||(w=new N),w);return{method:e,displayName:t.getPaymentMethodDisplayName(e),isOnline:t.isOnlinePaymentMethod(e),icon:t.getPaymentMethodIcon(e)}})(e),i=t===e;return(0,s.jsxs)("div",{className:"relative rounded-lg border p-4 cursor-pointer transition-all ".concat(i?"border-indigo-600 ring-2 ring-indigo-600 bg-indigo-50":"border-gray-300 hover:border-gray-400"," ").concat(n?"opacity-50 cursor-not-allowed":""),onClick:()=>{!n&&r(e)},children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-4 h-4 rounded-full border-2 flex items-center justify-center ".concat(i?"border-indigo-600 bg-indigo-600":"border-gray-300"),children:i&&(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})}),(0,s.jsxs)("div",{className:"flex-shrink-0",children:["esewa"===e&&(0,s.jsx)("div",{className:"w-12 h-8 bg-green-600 rounded flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white text-xs font-bold",children:"eSewa"})}),"khalti"===e&&(0,s.jsx)("div",{className:"w-12 h-8 bg-purple-600 rounded flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white text-xs font-bold",children:"Khalti"})}),"cod"===e&&(0,s.jsx)("div",{className:"w-12 h-8 bg-orange-600 rounded flex items-center justify-center",children:(0,s.jsxs)("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,s.jsx)("path",{d:"M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"}),(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z",clipRule:"evenodd"})]})})]}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:l.displayName}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:{esewa:"Pay securely with your eSewa wallet",khalti:"Pay with Khalti wallet or mobile banking",cod:"Pay in cash when your order is delivered"}[e]||""})]}),l.isOnline&&(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Online"})})]})}),i&&(0,s.jsx)("div",{className:"absolute -top-px -right-px rounded-tr-lg rounded-bl-lg bg-indigo-600 text-white p-1",children:(0,s.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),i&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-indigo-200",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-indigo-700",children:"Order Total:"}),(0,s.jsx)("span",{className:"font-semibold text-indigo-900",children:(0,j.vv)(a,"NPR")})]}),"cod"===e&&(0,s.jsxs)("p",{className:"mt-2 text-xs text-orange-700 bg-orange-50 p-2 rounded",children:[(0,s.jsx)("strong",{children:"Note:"})," You will pay in cash when your order is delivered. Please keep the exact amount ready."]}),"esewa"===e&&(0,s.jsx)("p",{className:"mt-2 text-xs text-green-700",children:"You will be redirected to eSewa to complete your payment securely."}),"khalti"===e&&(0,s.jsx)("p",{className:"mt-2 text-xs text-purple-700",children:"You will be redirected to Khalti to complete your payment securely."})]})]},e)})}),(0,s.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Secure Payment"})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Your payment information is encrypted and secure"]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Multiple payment options available"]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Easy refunds and 30-day return policy"]})]})]})]})}var C=r(3998);let P=(0,a.memo)(e=>{let{onSuccess:t,onError:r,orderTotal:n,guestEmail:l,onGuestEmailChange:i,onPaymentInitiate:o,customerInfo:c,onCustomerInfoChange:m,selectedAddress:u}=e,{user:h}=(0,d.A)(),[x,p]=(0,a.useState)("cod"),[y,g]=(0,a.useState)(!1),[f,v]=(0,a.useState)(""),[b,j]=(0,a.useState)({name:(null==h?void 0:h.name)||"",email:(null==h?void 0:h.email)||l||"",phone:"",address:"",city:"",postalCode:"",country:"US"}),N=c||b,w=m||j;(0,a.useEffect)(()=>{u&&j({name:u.fullName||N.name,email:N.email,phone:u.phone||N.phone,address:u.line1||N.address,city:u.city||N.city,postalCode:u.postalCode||N.postalCode,country:u.country||N.country})},[u]);let P=(0,a.useCallback)(async e=>{if(e.preventDefault(),!x){v("Please select a payment method"),r("Please select a payment method");return}if(!N.name||!N.email||!N.address){v("Please fill in all required fields"),r("Please fill in all required fields");return}g(!0),v("");try{if("cod"===x)v("Order placed successfully! You will pay on delivery."),t(x,"cod-".concat(Date.now()));else if(o){let e=await o(x);if(e.success&&e.paymentUrl)window.location.href=e.paymentUrl;else throw Error(e.error||"Failed to initiate payment")}}catch(t){console.error("Payment error:",t);let e=t instanceof Error?t.message:"Payment failed";v(e),r(e)}finally{g(!1)}},[x,N,t,r,o]),k=!u;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800",children:["Debug: CheckoutForm is rendering. Selected payment method: ",x||"none"]})}),(0,s.jsxs)("form",{onSubmit:P,className:"space-y-6",children:[k?(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Contact Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),(0,s.jsx)("input",{id:"name",type:"text",required:!0,value:N.name,onChange:e=>w({...N,name:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your full name"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),(0,s.jsx)("input",{id:"email",type:"email",required:!0,value:N.email,onChange:e=>{w({...N,email:e.target.value}),null==i||i(e.target.value)},className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your email address"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,s.jsx)("input",{id:"phone",type:"tel",value:N.phone,onChange:e=>w({...N,phone:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your phone number"})]})]})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Contact Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,s.jsx)("input",{id:"name",type:"text",required:!0,value:N.name,onChange:e=>w({...N,name:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your full name",readOnly:!!(null==u?void 0:u.fullName)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,s.jsx)("input",{id:"email",type:"email",required:!0,value:N.email,onChange:e=>{w({...N,email:e.target.value}),null==i||i(e.target.value)},className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your email address"})]}),(0,s.jsxs)("div",{className:"sm:col-span-2",children:[(0,s.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number (Optional)"}),(0,s.jsx)("input",{id:"phone",type:"tel",value:N.phone,onChange:e=>w({...N,phone:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your phone number"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Shipping Address"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"sm:col-span-2",children:[(0,s.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Street Address *"}),(0,s.jsx)("input",{id:"address",type:"text",required:!0,value:N.address,onChange:e=>w({...N,address:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your street address"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),(0,s.jsx)("input",{id:"city",type:"text",required:!0,value:N.city,onChange:e=>w({...N,city:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your city"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"postalCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"Postal Code *"}),(0,s.jsx)("input",{id:"postalCode",type:"text",required:!0,value:N.postalCode,onChange:e=>w({...N,postalCode:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your postal code"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-1",children:"Country *"}),(0,s.jsx)("input",{id:"country",type:"text",required:!0,value:N.country,onChange:e=>w({...N,country:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your country"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Payment Method"}),(0,s.jsx)(S,{selectedMethod:x,onMethodSelect:p,orderTotal:n})]}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,s.jsxs)("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[(0,s.jsx)("p",{children:"Order Total"}),(0,s.jsxs)("p",{children:["$",n.toFixed(2)]})]})}),f&&(0,s.jsx)("div",{className:"p-3 rounded-md ".concat(f.includes("successfully")?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:f}),(0,s.jsx)("div",{children:(0,s.jsx)(C.A,{type:"submit",loading:y,className:"w-full",disabled:y,children:y?"Processing...":"Place Order"})}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-4 flex items-center justify-center",children:[(0,s.jsxs)("div",{className:"flex items-center mr-4",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),"Your information is encrypted and secure"]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Multiple secure payment options available"]})]})]})]})});P.displayName="CheckoutForm";var k=r(59851),I=r(86948),A=r(87110),E=r(78334);function R(e){let{items:t}=e,[r,n]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0),[o,c]=(0,a.useState)("");(0,a.useEffect)(()=>{if(!t||0===t.length){n(null),d(!1);return}m()},[t]);let m=async()=>{try{d(!0),c("");let e=await fetch("/api/cart/summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.map(e=>({productId:e.productId,quantity:e.quantity}))})});if(!e.ok){let t=await e.text();throw console.error("Cart summary API error response:",t),Error("Failed to calculate order summary: ".concat(e.status," ").concat(e.statusText," - ").concat(t))}let r=await e.json();n(r.summary)}catch(e){c(e instanceof Error?e.message:"Failed to calculate order total");try{let e=(0,A.rs)(t);n({...e,taxRate:.13,shippingRate:200})}catch(s){console.error("Error calculating fallback summary:",s);let e=t.reduce((e,t)=>e+t.quantity,0),r=t.reduce((e,t)=>e+("string"==typeof t.product.basePrice?parseFloat(t.product.basePrice):t.product.basePrice||0)*t.quantity,0);n({subtotal:r,shipping:200,tax:.13*r,total:r+200+.13*r,itemsCount:e,freeShippingThreshold:2e3,freeShippingRemaining:Math.max(0,2e3-r),taxRate:.13,shippingRate:200})}}finally{d(!1)}};return l?(0,s.jsxs)(I.Zp,{className:"sticky top-8",children:[(0,s.jsx)(I.aR,{children:(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Order Summary"})}),(0,s.jsx)(I.Wu,{className:"flex justify-center py-8",children:(0,s.jsx)(E.h,{size:"md"})})]}):o&&!r?(0,s.jsxs)(I.Zp,{className:"sticky top-8",children:[(0,s.jsx)(I.aR,{children:(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Order Summary"})}),(0,s.jsxs)(I.Wu,{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-red-600 text-sm mb-4",children:o}),(0,s.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"Displaying estimated totals"}),(0,s.jsx)("button",{onClick:m,className:"mt-2 text-indigo-600 hover:text-indigo-500 text-sm",children:"Try again"})]})]}):r?(0,s.jsxs)(I.Zp,{className:"sticky top-8",children:[(0,s.jsx)(I.aR,{children:(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Order Summary"})}),(0,s.jsxs)(I.Wu,{className:"space-y-6",children:[(0,s.jsx)("div",{className:"space-y-4",children:t.map(e=>{var t;return(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"flex-shrink-0 relative",children:[(0,s.jsx)(k.default,{src:e.product.thumbnailUrl||"/placeholder-product.jpg",alt:e.product.name,width:60,height:60,className:"w-15 h-15 rounded-md object-cover"}),(0,s.jsx)("span",{className:"absolute -top-2 -right-2 bg-gray-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:e.quantity})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-900 truncate",children:(0,s.jsx)(i(),{href:"/products/".concat(e.product.slug),className:"hover:text-indigo-600",children:e.product.name})}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:(null==(t=e.product.category)?void 0:t.name)||e.product.category||"Uncategorized"})]}),(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(0,A.$g)(("string"==typeof e.product.basePrice?parseFloat(e.product.basePrice):e.product.basePrice||0)*e.quantity)})]},e.productId)})}),(0,s.jsxs)("div",{className:"border-t border-gray-200 pt-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsxs)("span",{className:"text-gray-600",children:["Subtotal (",r.itemsCount," ",1===r.itemsCount?"item":"items",")"]}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:(0,A.$g)(r.subtotal)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Shipping"}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:0===r.shipping?(0,s.jsx)("span",{className:"text-green-600",children:"Free"}):(0,A.$g)(r.shipping)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Tax"}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:(0,A.$g)(r.tax)})]}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-3",children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-base font-medium text-gray-900",children:"Total"}),(0,s.jsx)("span",{className:"text-base font-medium text-gray-900",children:(0,A.$g)(r.total)})]})})]}),0===r.shipping&&r.subtotal>=r.freeShippingThreshold&&(0,s.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:(0,s.jsxs)("p",{className:"text-sm text-green-800 font-medium",children:["\uD83C\uDF89 You saved ",(0,A.$g)(r.shippingRate)," on shipping!"]})}),r.shipping>0&&r.freeShippingRemaining>0&&(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800",children:["\uD83D\uDCA1 Add ",(0,A.$g)(r.freeShippingRemaining)," more to get free shipping!"]})}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,s.jsxs)("div",{className:"space-y-2 text-sm text-gray-600",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"30-day return policy"]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"1-year warranty included"]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Secure payment processing"]})]})}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Need help?"," ",(0,s.jsx)(i(),{href:"/contact",className:"text-indigo-600 hover:text-indigo-500",children:"Contact our support team"})]})})]})]}):null}var O=r(71509);function T(e){let{onValueChange:t,children:r}=e;return(0,s.jsx)("div",{className:"space-y-3",onChange:e=>{let r=e.target;"radio"===r.type&&t(r.value)},children:r})}function U(e){let{type:t="SHIPPING",selectedAddress:r,onAddressSelect:n,onAddressSave:l,showSaveOption:i=!0}=e,[d,o]=(0,a.useState)([]),[c,m]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),[x,p]=(0,a.useState)(!1),[y,g]=(0,a.useState)(null),[f,v]=(0,a.useState)(!0);(0,a.useEffect)(()=>{b()},[]);let b=async()=>{try{m(!0);let e=JSON.parse(localStorage.getItem("userAddresses")||"[]");o(e),h(null)}catch(e){h("Failed to fetch addresses")}finally{m(!1)}},j=async e=>{try{let t={id:"temp-"+Date.now(),...e,createdAt:new Date,updatedAt:new Date};o(e=>[...e,t]);let r=JSON.parse(localStorage.getItem("userAddresses")||"[]");r.push(t),localStorage.setItem("userAddresses",JSON.stringify(r)),l&&l(t),n(t),p(!1)}catch(e){alert(e instanceof Error?e.message:"Failed to create address")}},N=async e=>{f&&l?await j(e):(n({id:"temp-"+Date.now(),...e,type:t,isDefault:!1,createdAt:new Date,updatedAt:new Date}),p(!1))},w=()=>{p(!1),(null==r?void 0:r.id)||n(null)};if(c)return(0,s.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Loading addresses..."})});if(u)return(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-red-500 mb-4",children:u}),(0,s.jsx)(C.A,{onClick:b,children:"Retry"})]});let S=d.filter(e=>e.type===t);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h4",{className:"text-md font-medium text-gray-900",children:"Select Shipping Address"}),(0,s.jsx)(C.A,{variant:"outline",size:"sm",onClick:()=>{p(!0),g(null)},children:"Add New"})]}),!x&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(T,{value:(null==r?void 0:r.id)||"",onValueChange:e=>{if("new"===e){p(!0),g(null);return}let t=d.find(t=>t.id===e);t&&(n(t),p(!1))},children:(0,s.jsxs)("div",{className:"space-y-3",children:[S.map(e=>(0,s.jsx)(I.Zp,{className:"cursor-pointer transition-all duration-200 ".concat((null==r?void 0:r.id)===e.id?"ring-2 ring-blue-500 bg-blue-50":"hover:bg-gray-50"),children:(0,s.jsx)(I.Wu,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("input",{type:"radio",name:"address",value:e.id,checked:(null==r?void 0:r.id)===e.id,onChange:()=>{},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:e.fullName}),e.isDefault&&(0,s.jsx)("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded",children:"Default"})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 space-y-0.5",children:[(0,s.jsx)("div",{children:e.line1}),(0,s.jsxs)("div",{children:[e.city,", ",e.postalCode]}),(0,s.jsx)("div",{children:e.country}),e.phone&&(0,s.jsxs)("div",{children:["Phone: ",e.phone]}),(0,s.jsx)("div",{className:"text-blue-600",children:e.email})]})]})]})})},e.id)),(0,s.jsx)(I.Zp,{className:"cursor-pointer transition-all duration-200 ".concat((null==r?void 0:r.id)==="new"||x?"ring-2 ring-blue-500 bg-blue-50":"hover:bg-gray-50"),children:(0,s.jsx)(I.Wu,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("input",{type:"radio",name:"address",value:"new",checked:(null==r?void 0:r.id)==="new"||x,onChange:()=>{},className:"h-4 w-4 text-blue-600 focus:ring-blue-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 mb-1",children:"Add New Address"}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Enter a different shipping address"})]})]})})})]})}),r&&(0,s.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg animate-fadeIn",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("svg",{className:"h-5 w-5 text-green-400 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,s.jsxs)("div",{className:"text-sm text-green-700",children:[(0,s.jsx)("p",{className:"font-medium",children:"Address selected!"}),(0,s.jsx)("p",{className:"mt-1",children:"Ready to proceed with payment."})]})]})})]}),x&&(0,s.jsxs)("div",{className:"space-y-4 animate-fadeIn",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h4",{className:"text-md font-medium text-gray-900",children:"New Shipping Address"}),(0,s.jsx)(C.A,{variant:"outline",size:"sm",onClick:w,children:"Cancel"})]}),(0,s.jsx)(O.A,{initialData:y?{...y,type:t||"SHIPPING",email:y.email||"",phone:y.phone||""}:void 0,onSubmit:N,onCancel:w,title:"",submitLabel:"Use This Address"}),i&&(0,s.jsxs)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"saveAddress",checked:f,onChange:e=>v(e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,s.jsx)("label",{htmlFor:"saveAddress",className:"ml-2 block text-sm text-blue-700",children:"Save this address for future orders"})]}),!f&&(0,s.jsx)("p",{className:"mt-1 text-xs text-blue-600",children:"This address will only be used for this order."})]})]}),0===d.length&&!x&&(0,s.jsxs)("div",{className:"text-center py-6",children:[(0,s.jsx)("p",{className:"text-gray-500 mb-3",children:"No saved addresses found."}),(0,s.jsx)(C.A,{onClick:()=>p(!0),size:"sm",className:"w-full",children:"Add a shipping address"})]})]})}var F=r(57649);function q(){let e=(0,n.useRouter)(),{items:t,clearCart:r}=(0,F.x)(),[l,o]=(0,a.useState)(!1),{isAuthenticated:c,isLoading:m}=(0,d.A)(),[u,h]=(0,a.useState)(0),[x,p]=(0,a.useState)(!0),[y,g]=(0,a.useState)(""),[f,v]=(0,a.useState)(""),[b,j]=(0,a.useState)(null),[N,w]=(0,a.useState)(!1),[S,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{o(!0)},[]),(0,a.useEffect)(()=>{if(l){if(0===t.length&&!S)return void e.push("/cart");!m&&t.length>0&&A()}},[l,m,t,e,S]);let A=(0,a.useCallback)(async()=>{p(!0),g("");try{let e=await fetch("/api/cart/summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.map(e=>({productId:e.productId,quantity:e.quantity}))})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to calculate order total: ".concat(e.status," ").concat(e.statusText))}let r=await e.json();h(r.summary.total)}catch(e){g(e instanceof Error?e.message:"An error occurred while calculating order total"),h(t.reduce((e,t)=>{var r;let s=null!=(r=t.product.discountPrice)?r:t.product.price;return e+("string"==typeof s?parseFloat(s):s)*t.quantity},0))}finally{p(!1)}},[t]),T=async e=>{try{if(!b)throw Error("Please select a shipping address");let r=await fetch("/api/checkout/initiate-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({method:e,items:t.map(e=>({productId:e.productId,quantity:e.quantity})),guestEmail:c?void 0:f,shippingAddress:b})});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to initiate payment")}let s=await r.json();if(s.success)return{success:!0,paymentUrl:s.paymentUrl,transactionId:s.transactionId};return{success:!1,error:s.error||"Payment initiation failed"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Payment initiation failed"}}},q=async(s,a)=>{try{if("cod"===s&&b){let e=t.map(e=>{let t=e.product.basePrice,r=Number(t);if(isNaN(r))throw Error("Invalid price for product ".concat(e.productId));return{productId:e.productId,quantity:e.quantity,price:r}}),r=e.reduce((e,t)=>e+t.price*t.quantity,0),s={items:e,total:r,shippingAddress:b};c||(s.guestEmail=(null==b?void 0:b.email)||"",s.guestName=(null==b?void 0:b.fullName)||"");let a=await fetch(c?"/api/orders/create":"/api/orders/create-guest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||"Failed to create order")}await a.json()}}catch(e){console.error("Order creation failed:",e);return}k(!0),r(),e.push(c?"/orders":"/guest-orders")};return!l||m||x?(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,s.jsx)("div",{className:"flex justify-center items-center py-16",children:(0,s.jsx)(E.h,{size:"lg"})})}):y&&!b?(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,s.jsx)(I.Zp,{children:(0,s.jsxs)(I.Wu,{className:"p-8 text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Checkout Error"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:y}),(0,s.jsx)("button",{onClick:()=>e.push("/cart"),className:"bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700",children:"Return to Cart"})]})})}):(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Checkout"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"Complete your purchase securely"}),!c&&(0,s.jsx)("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsxs)("p",{className:"text-sm text-blue-700",children:["Checking out as guest.",(0,s.jsx)(i(),{href:"/auth/signin?redirect=/checkout",className:"font-medium underline hover:text-blue-600",children:"Sign in"})," ","or"," ",(0,s.jsx)(i(),{href:"/auth/signup?redirect=/checkout",className:"font-medium underline hover:text-blue-600",children:"create an account"})," ","to Add New Addresses and track your orders."]})})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,s.jsx)("div",{children:(0,s.jsxs)(I.Zp,{children:[(0,s.jsxs)(I.aR,{children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Enter Shipping Information"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Add or select your shipping address to continue"})]}),(0,s.jsxs)(I.Wu,{children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-sm font-medium text-white",children:"1"})}),(0,s.jsxs)("div",{className:"ml-3 text-sm font-medium text-blue-600",children:[(0,s.jsx)("div",{className:"font-semibold",children:"Step 1: Shipping Address"}),(0,s.jsx)("div",{className:"text-xs text-blue-500",children:"Select or enter your address"})]})]}),(0,s.jsx)("div",{className:"flex-1 mx-4 h-0.5 bg-blue-200"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ".concat(b?"bg-blue-600":"bg-gray-200"),children:(0,s.jsx)("span",{className:"text-sm font-medium ".concat(b?"text-white":"text-gray-500"),children:"2"})}),(0,s.jsxs)("div",{className:"ml-3 text-sm font-medium ".concat(b?"text-blue-600":"text-gray-500"),children:[(0,s.jsx)("div",{className:"font-semibold",children:"Step 2: Payment & Place Order"}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Complete your purchase"})]})]})]})}),(0,s.jsxs)("div",{className:"transition-all duration-300 ".concat(b?"mb-0":"mb-6"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Shipping Information"}),!b&&(0,s.jsx)("div",{className:"px-3 py-1 bg-amber-100 text-amber-800 text-xs font-medium rounded-full",children:"Required"})]}),c?(0,s.jsx)(U,{type:"SHIPPING",selectedAddress:b,onAddressSelect:e=>{e?j({fullName:e.fullName,email:"",phone:e.phone||void 0,address:"".concat(e.line1).concat(e.line2?", "+e.line2:""),city:e.city,postalCode:e.postalCode,country:e.country||"Nepal"}):j(null)},onAddressSave:e=>{j({fullName:e.fullName,email:"",phone:e.phone||void 0,address:"".concat(e.line1).concat(e.line2?", "+e.line2:""),city:e.city,postalCode:e.postalCode,country:e.country||"Nepal"})}}):(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"As a guest, you'll need to enter your shipping address for this order."}),N||b?!N&&b?(0,s.jsx)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Selected Address:"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,s.jsx)("div",{className:"font-medium",children:b.fullName}),(0,s.jsx)("div",{children:b.address}),(0,s.jsxs)("div",{children:[b.city,", ",b.postalCode]}),(0,s.jsx)("div",{children:b.email}),b.phone&&(0,s.jsx)("div",{children:b.phone})]})]}),(0,s.jsx)(C.A,{variant:"outline",onClick:()=>w(!0),size:"sm",children:"Change"})]})}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(O.A,{onSubmit:async e=>{j({fullName:e.fullName,email:e.email,phone:e.phone,address:e.address,city:e.city,postalCode:e.postalCode,country:e.country}),w(!1)},onCancel:()=>w(!1),title:"Shipping Address",submitLabel:"Use This Address"}),(0,s.jsx)(C.A,{variant:"outline",onClick:()=>w(!1),className:"w-full",children:"Cancel"})]}):(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"p-4 border-2 border-dashed border-gray-300 rounded-lg text-center",children:[(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsxs)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Add Your Shipping Address"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Enter your address to continue with your order"}),(0,s.jsx)(C.A,{onClick:()=>w(!0),className:"w-full",size:"lg",children:"Enter Shipping Address"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"This address will only be used for this order"})]})})]})]}),b&&(0,s.jsxs)("div",{className:"pt-6 border-t border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Information"}),(0,s.jsx)("div",{className:"px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:"Ready to Order"})]}),(0,s.jsx)("div",{className:"mb-5 p-3 bg-gray-50 rounded-lg",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:null==b?void 0:b.fullName}),(0,s.jsx)("div",{children:null==b?void 0:b.address}),(0,s.jsxs)("div",{children:[null==b?void 0:b.city,", ",null==b?void 0:b.postalCode]}),(0,s.jsx)("div",{children:null==b?void 0:b.email}),(null==b?void 0:b.phone)&&(0,s.jsx)("div",{children:b.phone})]}),!c&&(0,s.jsx)(C.A,{variant:"outline",onClick:()=>w(!0),size:"sm",children:"Change"})]})}),y&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,s.jsx)("p",{className:"text-sm text-yellow-800",children:"Note: There was an issue calculating your order total. We'll use a fallback calculation for now."})}),(0,s.jsx)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-green-800",children:"âœ“ Address selected! Ready to proceed with payment."})}),(0,s.jsx)(P,{onSuccess:q,onError:e=>g(e),orderTotal:u,guestEmail:f,onGuestEmailChange:v,onPaymentInitiate:T,selectedAddress:b})]}),b&&(0,s.jsx)("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 p-4 -mx-4 -mb-4 mt-6",children:(0,s.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,s.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Order Total"}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Cash on Delivery"})]}),(0,s.jsx)("span",{className:"text-2xl font-bold text-green-700",children:new Intl.NumberFormat("en-NP",{style:"currency",currency:"NPR"}).format(u)})]}),(0,s.jsx)(C.A,{onClick:()=>q("cod","cod-".concat(Date.now())),className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 text-lg shadow-lg hover:shadow-xl transition-all duration-200",size:"lg",children:"\uD83D\uDED2 Place Order Now"}),(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-2 text-center",children:"You will pay in cash when your order is delivered"})]})})}),l&&!b&&!x&&!m&&(0,s.jsx)("div",{className:"mt-6 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("svg",{className:"h-6 w-6 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-blue-900",children:"Almost there! Complete your order in 2 steps:"}),(0,s.jsxs)("div",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),(0,s.jsx)("span",{children:c?"Select or add a shipping address above":"Enter your shipping address above"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"w-2 h-2 bg-gray-300 rounded-full mr-2"}),(0,s.jsx)("span",{children:"Choose payment method and place your order"})]})]})]})]})})]})]})}),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsx)(R,{items:t})})]})]})}},46944:(e,t,r)=>{"use strict";var s=r(53936);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},57649:(e,t,r)=>{"use strict";r.d(t,{x:()=>l});var s=r(25959),a=r(89863);let n={getItem:e=>{let t=localStorage.getItem(e);if(!t)return null;try{return JSON.parse(t),t}catch(e){return null}},setItem:(e,t)=>{localStorage.setItem(e,t)},removeItem:e=>{localStorage.removeItem(e)}},l=(0,s.v)()((0,a.Zr)((e,t)=>({items:[],isOpen:!1,addItem:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=JSON.parse(JSON.stringify(t));e(e=>{let t=s.id,a=e.items.findIndex(e=>e.productId===t);if(-1===a)return{items:[...e.items,{productId:t,quantity:r,product:s}]};{let t=[...e.items];return t[a]={...t[a],quantity:t[a].quantity+r},{items:t}}})},removeItem:t=>{e(e=>({items:e.items.filter(e=>e.productId!==t)}))},updateQuantity:(r,s)=>{if(s<=0)return void t().removeItem(r);e(e=>{let t=e.items.findIndex(e=>e.productId===r);if(-1!==t){let r=[...e.items];return r[t]={...r[t],quantity:s},{items:r}}return{items:e.items}})},clearCart:()=>{e({items:[]})},openCart:()=>{e({isOpen:!0})},closeCart:()=>{e({isOpen:!1})},getTotalItems:()=>t().items.reduce((e,t)=>e+t.quantity,0),getTotalPrice:()=>t().items.reduce((e,t)=>e+Number(t.product.discountPrice||t.product.price)*t.quantity,0),getItemQuantity:e=>{let r=t().items.find(t=>t.productId===e);return r?r.quantity:0}}),{name:"cart-storage",storage:(0,a.KU)(()=>n),partialize:e=>({items:e.items}),onRehydrateStorage:()=>e=>{},migrate:(e,t)=>{if(!e||"object"!=typeof e)return e;if(e.items){let t=e.items.map(e=>{if((null==e?void 0:e.product)&&"object"==typeof e.product){let t=JSON.parse(JSON.stringify(e.product));return{...e,product:t,productId:e.productId||t.id}}return e});return{...e,items:t}}return e}}))},61289:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(89885),a=r(28175);function n(){var e,t;let{data:r,status:n}=(0,s.useSession)();(0,a.useEffect)(()=>{},[n,r]);let l=!!(null==r?void 0:r.user),i=(null==r||null==(e=r.user)?void 0:e.role)==="ADMIN",d="loading"===n;return{user:null==r?void 0:r.user,isLoading:d,isAuthenticated:l,isAdmin:i,isCustomer:(null==r||null==(t=r.user)?void 0:t.role)==="CUSTOMER",status:n}}},65142:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(49095),a=r(28175),n=r(2821);let l=(0,a.forwardRef)((e,t)=>{let{className:r,label:a,error:l,helperText:i,id:d,...o}=e,c=d||"input-".concat(Math.random().toString(36).substr(2,9));return(0,s.jsxs)("div",{className:"w-full",children:[a&&(0,s.jsx)("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,s.jsx)("input",{id:c,className:(0,n.$)("block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",l&&"border-red-300 focus:ring-red-500 focus:border-red-500",r),ref:t,...o}),l&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:l}),i&&!l&&(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:i})]})});l.displayName="Input";let i=l},71509:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var s=r(49095),a=r(28175),n=r(65142),l=r(3998),i=r(86948);function d(e){let{initialData:t,onSubmit:r,onCancel:d,submitLabel:o="Save Address",title:c="Address Information"}=e,[m,u]=(0,a.useState)({type:"SHIPPING",fullName:(null==t?void 0:t.fullName)||"",email:(null==t?void 0:t.email)||"",phone:(null==t?void 0:t.phone)||"",address:(null==t?void 0:t.address)||"",city:(null==t?void 0:t.city)||"",postalCode:(null==t?void 0:t.postalCode)||"",country:(null==t?void 0:t.country)||"Nepal",isDefault:(null==t?void 0:t.isDefault)||!1}),[h,x]=(0,a.useState)({}),[p,y]=(0,a.useState)(!1),g=e=>{let{name:t,value:r,type:s}=e.target;u(a=>({...a,[t]:"checkbox"===s?e.target.checked:r})),h[t]&&x(e=>{let r={...e};return delete r[t],r})},f=async e=>{if(e.preventDefault(),(()=>{let e={};return m.fullName.trim()||(e.fullName="Full name is required"),m.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.email)||(e.email="Invalid email address"):e.email="Email is required",m.address.trim()||(e.address="Address is required"),m.city.trim()||(e.city="City is required"),m.postalCode.trim()||(e.postalCode="Postal code is required"),x(e),0===Object.keys(e).length})()){y(!0);try{await r(m)}catch(e){}finally{y(!1)}}};return(0,s.jsxs)(i.Zp,{children:[(0,s.jsx)(i.aR,{children:(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:c})}),(0,s.jsx)(i.Wu,{children:(0,s.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address Type"}),(0,s.jsxs)("select",{name:"type",value:m.type,onChange:g,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"SHIPPING",children:"Shipping Address"}),(0,s.jsx)("option",{value:"BILLING",children:"Billing Address"})]})]}),(0,s.jsx)(n.A,{label:"Full Name",name:"fullName",value:m.fullName,onChange:g,error:h.fullName,required:!0}),(0,s.jsx)(n.A,{label:"Email",name:"email",type:"email",value:m.email,onChange:g,error:h.email,required:!0}),(0,s.jsx)(n.A,{label:"Phone (Optional)",name:"phone",value:m.phone||"",onChange:g,error:h.phone}),(0,s.jsx)(n.A,{label:"Address",name:"address",value:m.address,onChange:g,error:h.address,required:!0}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsx)(n.A,{label:"City",name:"city",value:m.city,onChange:g,error:h.city,required:!0}),(0,s.jsx)(n.A,{label:"Postal Code",name:"postalCode",value:m.postalCode,onChange:g,error:h.postalCode,required:!0})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsx)(n.A,{label:"Country",name:"country",value:m.country,onChange:g,error:h.country}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"isDefault",name:"isDefault",checked:m.isDefault,onChange:g,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,s.jsx)("label",{htmlFor:"isDefault",className:"ml-2 block text-sm text-gray-900",children:"Set as default address"})]})]}),(0,s.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,s.jsx)(l.A,{type:"submit",disabled:p,className:"flex-1",children:p?"Saving...":o}),d&&(0,s.jsx)(l.A,{type:"button",variant:"outline",onClick:d,disabled:p,className:"flex-1",children:"Cancel"})]})]})})]})}},78334:(e,t,r)=>{"use strict";r.d(t,{h:()=>n});var s=r(49095),a=r(2821);function n(e){let{size:t="md",className:r}=e;return(0,s.jsx)("div",{className:(0,a.$)("animate-spin rounded-full border-2 border-gray-300 border-t-indigo-600",{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t],r),suppressHydrationWarning:!0})}},86948:(e,t,r)=>{"use strict";r.d(t,{Wu:()=>d,ZB:()=>o,Zp:()=>l,aR:()=>i});var s=r(49095),a=r(28175),n=r(2821);let l=(0,a.forwardRef)((e,t)=>{let{className:r,variant:a="default",...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.$)("rounded-lg",{default:"bg-white border border-gray-200",outlined:"bg-white border-2 border-gray-300",elevated:"bg-white shadow-lg border border-gray-100"}[a],r),...l,suppressHydrationWarning:!0})});l.displayName="Card";let i=(0,a.forwardRef)((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.$)("px-4 py-3 sm:px-6 sm:py-4 border-b border-gray-200",r),...a,suppressHydrationWarning:!0})});i.displayName="CardHeader";let d=(0,a.forwardRef)((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.$)("px-4 py-3 sm:px-6 sm:py-4",r),...a,suppressHydrationWarning:!0})});d.displayName="CardContent";let o=(0,a.forwardRef)((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.$)("text-lg font-semibold leading-6 text-gray-900",r),...a,suppressHydrationWarning:!0})});o.displayName="CardTitle",(0,a.forwardRef)((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.$)("text-sm text-gray-600 mt-1",r),...a,suppressHydrationWarning:!0})}).displayName="CardDescription",(0,a.forwardRef)((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.$)("px-4 py-3 sm:px-6 sm:py-4 border-t border-gray-200",r),...a,suppressHydrationWarning:!0})}).displayName="CardFooter"},89863:(e,t,r)=>{"use strict";function s(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var s;let a=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),n=null!=(s=r.getItem(e))?s:null;return n instanceof Promise?n.then(a):a(n)},setItem:(e,s)=>r.setItem(e,JSON.stringify(s,null==t?void 0:t.replacer)),removeItem:e=>r.removeItem(e)}}r.d(t,{KU:()=>s,Zr:()=>n});let a=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>a(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>a(t)(e)}}},n=(e,t)=>(r,n,l)=>{let i,d={storage:s(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1,c=new Set,m=new Set,u=d.storage;if(!u)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${d.name}', the given storage is currently unavailable.`),r(...e)},n,l);let h=()=>{let e=d.partialize({...n()});return u.setItem(d.name,{state:e,version:d.version})},x=l.setState;l.setState=(e,t)=>(x(e,t),h());let p=e((...e)=>(r(...e),h()),n,l);l.getInitialState=()=>p;let y=()=>{var e,t;if(!u)return;o=!1,c.forEach(e=>{var t;return e(null!=(t=n())?t:p)});let s=(null==(t=d.onRehydrateStorage)?void 0:t.call(d,null!=(e=n())?e:p))||void 0;return a(u.getItem.bind(u))(d.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===d.version)return[!1,e.state];else{if(d.migrate){let t=d.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;let[s,a]=e;if(r(i=d.merge(a,null!=(t=n())?t:p),!0),s)return h()}).then(()=>{null==s||s(i,void 0),i=n(),o=!0,m.forEach(e=>e(i))}).catch(e=>{null==s||s(void 0,e)})};return l.persist={setOptions:e=>{d={...d,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(d.name)},getOptions:()=>d,rehydrate:()=>y(),hasHydrated:()=>o,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(m.add(e),()=>{m.delete(e)})},d.skipHydration||y(),i||p}}},e=>{e.O(0,[6447,9885,7640,9851,2313,3575,7358],()=>e(e.s=35848)),_N_E=e.O()}]);